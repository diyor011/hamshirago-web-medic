# HamshiraGo ‚Äî –ó–∞–¥–∞—á–∏ –¥–ª—è –±—ç–∫–µ–Ω–¥–∞

> –°–ø–∏—Å–æ–∫ –±–∞–≥–æ–≤ –∏ —É–ª—É—á—à–µ–Ω–∏–π –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ `backend/`.
> –§—Ä–æ–Ω—Ç–µ–Ω–¥ (web, web-medic, admin) —ç—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ —Ä–µ—à–∞–µ—Ç.

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –¥–æ production)

### BUG-13: –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Ä–æ—É—Ç–æ–≤ ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–æ—É—Ç—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
- **–§–∞–π–ª:** `backend/src/orders/orders.controller.ts`
- **–ü—Ä–æ–±–ª–µ–º–∞:** `GET /orders/:id` –æ–±—ä—è–≤–ª–µ–Ω —Ä–∞–Ω—å—à–µ `GET /orders/medic/available` –∏ `GET /orders/admin/all` ‚Äî NestJS –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ `medic` –∏ `admin` –∫–∞–∫ `:id`
- **–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–æ—É—Ç—ã (`medic/available`, `admin/all`) **–≤—ã—à–µ** `@Get(':id')`

### BUG-2: PATCH /orders/:id/status ‚Äî –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞
- **–§–∞–π–ª:** `backend/src/orders/orders.controller.ts:76-80`
- **–ü—Ä–æ–±–ª–µ–º–∞:** –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ª—é–±–æ–≥–æ –∑–∞–∫–∞–∑–∞
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —á—Ç–æ –≤—ã–∑—ã–≤–∞—é—â–∏–π ‚Äî –∫–ª–∏–µ–Ω—Ç –∏–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –º–µ–¥–∏–∫

### BUG-1: Race condition –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞–∫–∞–∑–∞
- **–§–∞–π–ª:** `backend/src/orders/orders.service.ts:278-299`
- **–ü—Ä–æ–±–ª–µ–º–∞:** –î–≤–∞ –º–µ–¥–∏–∫–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –º–æ–≥—É—Ç –ø—Ä–∏–Ω—è—Ç—å –æ–¥–∏–Ω –∑–∞–∫–∞–∑
- **–†–µ—à–µ–Ω–∏–µ:** –ê—Ç–æ–º–∞—Ä–Ω—ã–π `UPDATE orders SET medicId=?, status='ASSIGNED' WHERE id=? AND status='CREATED'`

### BUG-3: WebSocket ‚Äî –Ω–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è `subscribe_order`
- **–§–∞–π–ª:** `backend/src/realtime/order-events.gateway.ts:61-71`
- **–ü—Ä–æ–±–ª–µ–º–∞:** –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ª—é–±–æ–π –∑–∞–∫–∞–∑ –∏ –ø–æ–ª—É—á–∞—Ç—å GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–µ–¥–∏–∫–∞
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å —á—Ç–æ –ø–æ–¥–ø–∏—Å—á–∏–∫ ‚Äî –≤–ª–∞–¥–µ–ª–µ—Ü –∑–∞–∫–∞–∑–∞ –∏–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –º–µ–¥–∏–∫

### BUG-4: GET /orders/:id ‚Äî –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞
- **–§–∞–π–ª:** `backend/src/orders/orders.controller.ts:51-54`
- **–ü—Ä–æ–±–ª–µ–º–∞:** –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ª—é–±–æ–≥–æ –∑–∞–∫–∞–∑–∞ (–∞–¥—Ä–µ—Å –∫–ª–∏–µ–Ω—Ç–∞, —Ç–µ–ª–µ—Ñ–æ–Ω)
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤–ª–∞–¥–µ–ª—å—Ü–∞ –≤ `findOne`

---

## üü† –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

### BUG-11: WebSocket CORS —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Å–µ origin
- **–§–∞–π–ª:** `backend/src/realtime/order-events.gateway.ts:23`
- **–ü—Ä–æ–±–ª–µ–º–∞:** `@WebSocketGateway({ cors: { origin: '*' } })` ‚Äî –ª—é–±–æ–π —Å–∞–π—Ç –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
- **–†–µ—à–µ–Ω–∏–µ:** –£–∫–∞–∑–∞—Ç—å —Ç–µ –∂–µ origin —á—Ç–æ –∏ –≤ REST API CORS –∫–æ–Ω—Ñ–∏–≥–µ

### BUG-10: updateStatus ‚Äî –Ω–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ state machine
- **–§–∞–π–ª:** `backend/src/orders/orders.service.ts:199-205`
- **–ü—Ä–æ–±–ª–µ–º–∞:** `updateStatus` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª—é–±–æ–π —Å—Ç–∞—Ç—É—Å –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å allowedTransitions –∫–∞–∫ –≤ `updateStatusByMedic`

### BUG-9: ClientId –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç '' –≤–º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏
- **–§–∞–π–ª:** `backend/src/auth/decorators/client-id.decorator.ts:3-8`
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ `request.user` undefined ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É, –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å `clientId = ''`
- **–†–µ—à–µ–Ω–∏–µ:** –ë—Ä–æ—Å–∞—Ç—å `UnauthorizedException` –≤–º–µ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ `''`

### BUG-12: Admin login ‚Äî –Ω–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ DTO
- **–§–∞–π–ª:** `backend/src/auth/auth.controller.ts:100-102`
- **–ü—Ä–æ–±–ª–µ–º–∞:** `adminLogin` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç plain object –±–µ–∑ `@IsString()` –∏ –¥—Ä—É–≥–∏—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–π
- **–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å `AdminLoginDto` —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

### BUG-5: Admin –ø–∞—Ä–æ–ª—å —É—è–∑–≤–∏–º –∫ timing attack
- **–§–∞–π–ª:** `backend/src/auth/auth.service.ts:53`
- **–ü—Ä–æ–±–ª–µ–º–∞:** `password !== adminPassword` ‚Äî –ø—Ä—è–º–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫
- **–†–µ—à–µ–Ω–∏–µ:** `crypto.timingSafeEqual(Buffer.from(password), Buffer.from(adminPassword))`

### BUG-6: –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- **–§–∞–π–ª—ã:** `backend/src/auth/dto/register-client.dto.ts`, `login.dto.ts`, `register-medic.dto.ts`
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—è `phone` —Ç–æ–ª—å–∫–æ `@IsString()` ‚Äî –ª—é–±–∞—è —Å—Ç—Ä–æ–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç
- **–†–µ—à–µ–Ω–∏–µ:** `@Matches(/^\+998\d{9}$/, { message: '–ù–æ–º–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ +998XXXXXXXXX' })`

### BUG-7 / BUG-34: name –ø–æ–ª–µ ‚Äî –Ω–µ—Ç @IsOptional()
- **–§–∞–π–ª:** `backend/src/auth/dto/register-client.dto.ts`
- **–ü—Ä–æ–±–ª–µ–º–∞:** `name?: string` –≤ TypeScript, –Ω–æ `@IsString()` –æ—Ç–∫–ª–æ–Ω—è–µ—Ç `undefined`
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å `@IsOptional()` –ø–µ—Ä–µ–¥ `@IsString()`

---

## üü° –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

### BUG-17: notifyClient –Ω–µ –∂–¥—ë—Ç push –æ–ø–µ—Ä–∞—Ü–∏–π
- **–§–∞–π–ª:** `backend/src/orders/orders.service.ts:48-72`
- **–ü—Ä–æ–±–ª–µ–º–∞:** `this.pushService.send()` –∏ `this.webPushService.sendToSubscriber()` –±–µ–∑ `await` ‚Äî –æ—à–∏–±–∫–∏ —Ç–µ—Ä—è—é—Ç—Å—è
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å `await` –∏–ª–∏ —Ö–æ—Ç—è –±—ã `.catch(err => logger.error(err))`

### BUG-18: JwtPayload –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç —Ä–æ–ª—å admin
- **–§–∞–π–ª:** `backend/src/auth/strategies/jwt.strategy.ts:8`
- **–ü—Ä–æ–±–ª–µ–º–∞:** `role: 'client' | 'medic'` ‚Äî —Ä–æ–ª—å `admin` –Ω–µ –æ–ø–∏—Å–∞–Ω–∞ –≤ —Ç–∏–ø–µ
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å `'admin'` –≤ union —Ç–∏–ø

### BUG-19: discountAmount ‚Äî nullable –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ
- **–§–∞–π–ª:** `backend/src/orders/entities/order.entity.ts:40`
- **–ü—Ä–æ–±–ª–µ–º–∞:** TypeScript `number` (not nullable), –ë–î `nullable: true`
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ–¥–Ω–æ–º—É –≤–∏–¥—É: `number | null` –≤ TypeScript

### BUG-37: –ú–µ–¥–∏–∫ balance ‚Äî decimal –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–∞–∫ string
- **–§–∞–π–ª:** `backend/src/medics/entities/medic.entity.ts:63`
- **–ü—Ä–æ–±–ª–µ–º–∞:** TypeORM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `decimal` –∫–æ–ª–æ–Ω–∫–∏ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏ –∏–∑ PostgreSQL
- **–†–µ—à–µ–Ω–∏–µ:** –ü–∞—Ä—Å–∏—Ç—å —á–µ—Ä–µ–∑ `parseFloat()` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `transformer`

### BUG-38 / BUG-39: medic_location —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç—Å—è –≤—Å–µ–º –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
- **–§–∞–π–ª:** `backend/src/realtime/order-events.gateway.ts:91-107, 124`
- **–ü—Ä–æ–±–ª–µ–º–∞:** –õ—é–±–æ–π –º–µ–¥–∏–∫ –º–æ–∂–µ—Ç —Å–ª–∞—Ç—å GPS –¥–ª—è –ª—é–±–æ–≥–æ –∑–∞–∫–∞–∑–∞; –ª—é–±–æ–π –≤ –∫–æ–º–Ω–∞—Ç–µ –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å `medicId === order.medicId` –ø–µ—Ä–µ–¥ emit

---

## üì± MOBILE (–æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –±—ç–∫–µ–Ω–¥–∞)

### BUG-20: –¢–æ–∫–µ–Ω –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–§–∞–π–ª—ã:** `mobile/context/AuthContext.tsx`, `medic/context/AuthContext.tsx`
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `expo-secure-store` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è JWT

### BUG-21: –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–∞—Ä—à—Ä—É—Ç
- **–§–∞–π–ª:** `mobile/app/(tabs)/two.tsx:212`
- **–ü—Ä–æ–±–ª–µ–º–∞:** `OrderCard` –Ω–∞–≤–∏–≥–∏—Ä—É–µ—Ç –Ω–∞ `/order/track` ‚Äî —Ñ–∞–π–ª–∞ –Ω–µ—Ç
- **–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å `track.tsx` –∏–ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—É—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

### BUG-8: refreshProfile ‚Äî async –≤ setState
- **–§–∞–π–ª:** `medic/context/AuthContext.tsx:68-76`
- **–†–µ—à–µ–Ω–∏–µ:** –í—ã–Ω–µ—Å—Ç–∏ async –ª–æ–≥–∏–∫—É –∏–∑ setState callback

### BUG-22/23/24/25: useEffect –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –≥–ª–æ—Ç–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- **–§–∞–π–ª—ã:** `mobile/app/order/location.tsx`, `mobile/app/(tabs)/index.tsx`, `medic/app/(tabs)/index.tsx`
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ dependency array; –∑–∞–º–µ–Ω–∏—Ç—å `.catch(() => {})` –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

---

## üí° –£–õ–£–ß–®–ï–ù–ò–Ø (–Ω–µ –±–∞–≥–∏)

- `PATCH /auth/profile` ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (–Ω—É–∂–Ω–æ –¥–ª—è web/mobile)
- `PATCH /auth/change-password` ‚Äî —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è –∫–ª–∏–µ–Ω—Ç–∞
- `PATCH /medics/profile` ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –º–µ–¥–∏–∫–∞
- `DELETE /auth/account` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ (GDPR)
- WebSocket –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ JWT –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ (–Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ)
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤–º–µ—Å—Ç–æ `synchronize: true` –¥–ª—è production –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
